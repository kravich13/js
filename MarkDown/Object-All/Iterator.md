## Итераторы

Объект является **итератором**, если он умеет обращаться к элементам своей коллекции по одному за раз и при этом может отслеживать своё текущее положение внутри этой последовательности.

В JS итератор - это объект, который предоставляет метод `next()`, возвращающий следующий элемент в последовательности. Этот метод возвращает объект с двумя свойствами: `done` и `value`.

Пример работы итератора под капотом: 

```javascript
const name = ["Vlad", "Kravich", "22 years"]

function iterator (arr) {
    let index = 0 // текущее число

    return { // возвращает объект
        next: function () {
            if (index < arr.length) { // если число меньше длинны массива, выдать arr[index]
                return { value: arr[index++], done: false }
            }
            return { done: true } // если длинна массива кончилась - вернуть true
        }
    }
}

const it = iterator(name)

console.log(it.next().value) // вернёт первый индекс массива
console.log(it.next().value) // вернёт второй индекс массива
console.log(it.next().value) // вернёт третий индекс массива

// т.е. каждый вызов next() запоминает своё положение и выдаёт следующий результат
```
***

## Итерированный объект

Итерировать можно только тот объект, у которого реализован метод `[Symbol.iterator]()`.

Последовательность действий следующая: 

1. Цикл `for...of` один раз вызывает этот метод. Метод должен вернуть объект итератор с реализованным методом `obj.next()`. Вся дальнейшая работа производится только с этим возвращаемым объектом. 
2. На каждой итерации цикла вызывается метод `next()` у этого объекта итератора.
3. Метод `next()` возвращает объект с двумя полями: `value` and `done`. В первом - текущее значение итерации, второй сигнализирует об окончании.
4. Повторить пункты **2** и **3**, пока не будет `done: true`.

```javascript
const range = {
  from: 1, // от
  to: 5 // до
}

// 1. вызов for..of сначала вызывает эту функцию
range[Symbol.iterator] = function() {

  // ...она возвращает объект итератора:
  // 2. Далее, for..of работает только с этим итератором, запрашивая у него новые значения
  return {
    current: this.from,
    last: this.to,

    // 3. next() вызывается на каждой итерации цикла for..of
    next() {
      // 4. он должен вернуть значение в виде объекта {done:.., value :...}
      if (this.current <= this.last) {
        return { done: false, value: this.current++ }
      } 
      else {
        return { done: true }
      }
    }
  }
}

// теперь работает!
for (let num of range) {
  console.log(num) // 1, затем 2, 3, 4, 5
}
```
***

## Явный вызов итератора

Перебор строки с помощью обычного цикла, ручками.

```javascript
let str = "Hello"

// делает то же самое, что и
// for (let char of str) alert(char);

const iterator = str[Symbol.iterator]()

while (true) {
  let result = iterator.next()
  if (result.done) break
  console.log(result.value) // выводит символы из строки один за другим
}
```
