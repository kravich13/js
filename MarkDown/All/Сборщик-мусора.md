# Сборка мусора

## Достижимость 

Основной концепцией управления памятью в JavaScript является принцип достижимости.

Достижимые значения - это те, которые доступны или используются. Они гарантировано находятся в памяти.

1. Существует базовое множество достижимых значений, которые не могут быть удалены:

    * Локальные переменные и параметры текущей функции;
    * Переменные и параметры других функций в текущей цепочке вложенных вызовов;
    * Глобальные переменные;
    * (некоторые другие внутренние значения).

2. Любое другое значение считается достижимым, если оно доступно из корня по ссылке или по цепочке ссылок.

    Например, если в локальной переменной есть объект и он имеет свойство, в котором хранится ссылка на другой объект, то этот объект считается достижимым. И те, на которые ссылается, тоже достижимы.

В интерпретаторе JavaScript есть фоновый процесс, который называется сборщик мусора. Он следит за всеми объектами и удаляет те, которые стали недостижимы. Т.е. сборщик мусора работает автоматически, его нельзя изменить или остановить.
***

## Самый простой пример

```javascript
// в user находится ссылка на объект
const user = {
    name: "Vlad"
}
```
Здесь глобальная константа `user` ссылается на объект `{name: "Vlad"}`. 

Если перезаписать значение `user` - ссылка теряется: 

```javascript
user = null
// null
```
Теперь объект `user` становится недостижимым. К нему нет доступа, на него нет ссылок. Сборщик мусора удаляет эти данные и освободит память.
***

## Две ссылки

```javascript
const user = {
    name: "Vlad"
}

// скопировали в переменную admin объект user
const admin = user
```

Теперь, если сделать тоже самое:

```javascript
user = null
```

...то объект всё ещё достижим через глобальную переменную `admin`, по этому он находится в памяти. Если так же перезаписать `admin`, то `user` был бы удалён.
***

## Взаимосвязные объекты

```javascript
function kravich (man, woman) {
    woman.husband = man 
    man.wife = woman

    return {
        father: man,
        mother: woman
    }
}

const family = kravich ({ 
    name: "Vlad"
},
{
    name: "Marina"
})
```

Функция `kravich` "женит" два объекта, давая им ссылки друг на друга и возвращает новый объект, содержащий ссылки на два предыдущих.

В результате получаем такую структуру памяти: 

`object` =>>> `Object name: "Vlad"` => , <= `Object name: "Marina"`

Да текущий момент все объекты достижимы.

Теперь удалим две ссылки: 

```javascript
delete family.father
delete family.mother.husband
```

Недостаточно удалить только одну из этих ссылок, потому что все объекты останутся достижимыми.

Но если удалить обе, то у объекта `vlad` больше нет входящих ссылок.

